<div class="row">
  <h1 class="text-center title"><%= t "request_shop.domain" %></h1>
</div>
<div class="common">
  <div class="row alert" role="alert"></div>

  <div class="row margin-top-50">
    <div class="col-lg-12">
      <table class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th><%= t "request_shop.domain_name" %></th>
            <th><%= t "members" %></th>
            <th><%= t "shop" %></th>
            <th><%= t "products" %></th>
            <th><%= t "request_shop.status" %></th>
            <th class="text-center"><%= t "request_shop.request_to_domain" %></th>
          </tr>
        </thead>
        <tbody>
          <% @user_domains.each do |domain|  %>
            <tr>
              <td><%= domain.name %></td>
              <td><%= domain.users.size %></td>
              <td><%= domain.shop_domains.approved.size %></td>
              <td><%= domain.products.size %></td>
              <td>
                <% if domain.shops.include? @shop %>
                  <%= @shop.request_status(domain).status %>
                <% end %>
              </td>
              <td class="text-center">
                <% shop_domain = ShopDomain.find_by shop_id: @shop.id,
                  domain_id: domain.id %>
                <% if !domain.shops.include?(@shop) ||
                  @shop.request_status(domain).rejected? %>
                  <% if domain.owner? current_user.id %>
                    <%= link_to t("request_shop.request_to_domain"),
                      shop_domains_path(shop_id: @shop.id,
                      domain_id: domain.id, status: :approved), method: :post,
                      class: "btn btn-info refresh" %>
                  <% else %>
                    <%= link_to t("request_shop.request_to_domain"),
                      shop_domains_path(shop_id: @shop.id,
                      domain_id: domain.id, status: :pending), method: :post,
                      class: "btn btn-info refresh"%>
                  <% end %>
                <% else %>
                  <%= link_to t("request_shop.cancel"),
                    shop_domain_path(shop_domain,
                    domain_id: domain.id, shop_id: @shop.id), method: :delete,
                    class: "btn btn-danger"
                  %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
